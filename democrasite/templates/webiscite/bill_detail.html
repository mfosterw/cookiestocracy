{% extends 'base.html' %}

{% load i18n static %}

{% block sub_title %}
  {{ bill.name }}
{% endblock sub_title %}
{% block content %}
  <div class="container">
    <div class="row">
      <div class="col">
        <h2>{{ bill }}</h2>
        {% if bill.constitutional %}
          <p class="text-info">{% trans 'Amendment to the Constitution' %}</p>
        {% endif %}
        {% if bill.status != bill.Status.OPEN %}
          <p class="{% if bill.status == bill.Status.APPROVED %}
                      text-success
                    {% else %}
                      text-danger
                    {% endif %}">{{ bill.get_status_display }}</p>
        {% endif %}
        <p>
          {{ bill.description }}
          {% if bill.author == user and bill.status == bill.Status.OPEN %}
            <a href="{{ bill.get_update_url }}">
              <i class="bi bi-pencil-square"></i>
            </a>
          {% endif %}
          <br />
          <a class="git-pull-link"
             href="{{ bill.pull_request.diff_url }}"
             target="_blank">
            Diff:
            <span class="text-success">+{{ bill.pull_request.additions }}</span>
            <span class="text-danger">-{{ bill.pull_request.deletions }}</span>
          </a>
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-3
                  {% if bill.status != bill.Status.OPEN %}inactive{% endif %}">
        <div class="progress">
          <div class="progress-bar bg-success" role="progressbar"></div>
          <div class="progress-bar bg-danger" role="progressbar"></div>
        </div>
        <a href="javascript:;" class="float-left text-success mt-2 vote{% if user in bill.yes_votes.all %} font-weight-bold{% endif %}"
          {% if bill.status == bill.Status.OPEN %}
            {% if user.is_authenticated %}
              {# if logged in, add vote-enabling logic #}
              id="vote-yes-{{ bill.id }}"
              action="{{ bill.get_vote_url }}"
              value="vote-yes"
            {% else %}
              {# otherwise, add a "log in to vote" popup #}
              data-toggle="tooltip" data-placement="bottom"
              title="Log in to vote" data-trigger="click"
            {% endif %}
          {% endif %}
          >
          âœ“ {% trans 'Yes' %}: <span class="num-yes-votes" id="num-yes-votes-{{ bill.id }}">{{ bill.yes_votes.count }}</span>
        </a>
        <a href="javascript:;"
           class="float-right text-danger mt-2 vote
                  {% if user in bill.no_votes.all %}font-weight-bold{% endif %}"
           {% if bill.status == bill.Status.OPEN %}
             {% if user.is_authenticated %}
               id="vote-no-{{ bill.id }}" action="{{ bill.get_vote_url }}" value="vote-no"
             {% else %}
               data-toggle="tooltip" data-placement="bottom" title="{% trans 'Log in to vote' %}" data-trigger="click"
             {% endif %}
           {% endif %}>
          X {% trans 'No' %}: <span class="num-no-votes" id="num-no-votes-{{ bill.id }}">{{ bill.no_votes.count }}</span>
        </a>
      </div>
    </div>
  </div>
{% endblock content %}
{% block inline_javascript %}
  <script type="text/javascript" src="{% static 'js/bill.js' %}"></script>
  {% if user.is_authenticated and bill.status == bill.Status.OPEN %}
    <script type="text/javascript" src="{% static 'js/vote.js' %}"></script>
  {% endif %}
{% endblock inline_javascript %}
